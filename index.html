<!doctype html>
<html>

<head>
    <title>Socket.IO chat</title>
</head>

<body>
    <div style="width: 20%; float: left;">
        <ul id="messages"></ul>
    </div>
    <div id="divRight" style="width: 80%; float: right;">

    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.js"></script>
    <script>
        var accelerometer = [];
        var gyroscope = [];
        var magnetometer = [];
        var orientation = [];

        var targetRotation = 0;
        var renderer, scene, camera;

        $(function () {
            init();
            animate();

            var socket = io();
            socket.on('message', function (data) {
                if (data.accelerometer) {
                    accelerometer.push(data.accelerometer);
                    $('#messages').prepend($('<li>').text("acc:" + JSON.stringify(data.accelerometer)));
                }
                if (data.gyroscope) {
                    gyroscope.push(data.gyroscope);
                    $('#messages').prepend($('<li>').text("gyro:" + JSON.stringify(data.gyroscope)));

                    cube.rotateX(data.gyroscope.x * Math.PI / 180);
                    cube.rotateZ(-1 * data.gyroscope.y * Math.PI / 180);
                    cube.rotateY(data.gyroscope.z * Math.PI / 180);
                }
                if (data.magnetometer) {
                    magnetometer.push(data.magnetometer);
                    $('#messages').prepend($('<li>').text("magne:" + JSON.stringify(data.magnetometer)));
                }
                if (data.orientation) {
                    orientation.push(data.orientation);
                    $('#messages').prepend($('<li>').text("magne:" + JSON.stringify(data.orientation)));
                    //cube.rotation.y = -1 * data.orientation.x * Math.PI / 180;
                    //cube.rotation.x = -1 * data.orientation.y * Math.PI / 180;
                    //cube.rotation.z = -1 * data.orientation.z * Math.PI / 180;
                }
            });
        });

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 1000);
            camera.position.y = 150;
            camera.position.z = 500;

            var geometry = new THREE.BoxGeometry(300, 50, 500);
            for (var i = 0; i < geometry.faces.length; i += 2) {
                var hex = Math.random() * 0xffffff;
                geometry.faces[i].color.setHex(hex);
                geometry.faces[i + 1].color.setHex(hex);
            }
            var material = new THREE.MeshBasicMaterial({
                vertexColors: THREE.FaceColors,
                overdraw: 0.5
            });

            cube = new THREE.Mesh(geometry, material);
            cube.position.y = 150;
            scene.add(cube);

            var geometry = new THREE.PlaneBufferGeometry(200, 200);
            geometry.rotateX(-Math.PI / 2);

            var material = new THREE.MeshBasicMaterial({
                color: 0xe0e0e0,
                overdraw: 0.5
            });

            plane = new THREE.Mesh(geometry, material);
            scene.add(plane);

            renderer = new THREE.WebGLRenderer();
            renderer.setClearColor(0xf0f0f0);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('divRight').appendChild(renderer.domElement);
        }

        function animate() {
            requestAnimationFrame(animate);
            render();
        }

        function render() {
            renderer.render(scene, camera);
        }
    </script>
</body>

</html>